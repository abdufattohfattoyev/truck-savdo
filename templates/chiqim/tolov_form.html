<form id="tolovForm" method="post" class="p-3 ajax-form">
    {% csrf_token %}
    <div id="errorContainer" class="alert alert-danger d-none" role="alert"></div>
    <div class="mb-3">
        <label for="tolov_turi" class="form-label">Payment Type</label>
        <select name="tolov_turi" id="tolov_turi" class="form-select" required>
            <option value="" disabled selected>Select payment type</option>
            {% for value, label in form.tolov_turi.field.choices %}
                <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
        <div id="tolovTuriError" class="invalid-feedback">
            {% for error in form.tolov_turi.errors %}
                {{ error }}<br>
            {% endfor %}
        </div>
    </div>
    <div class="mb-3">
        <label for="summa" class="form-label">Amount (Balance: ${{ chiqim.qoldiq_summa|floatformat:2 }})</label>
        <input type="number" step="0.01" name="summa" id="summa" class="form-control" required min="0.01">
        <div id="summaError" class="invalid-feedback">
            {% for error in form.summa.errors %}
                {{ error }}<br>
            {% endfor %}
        </div>
    </div>
    <div class="mb-3">
        <label for="firma_nomi" class="form-label">Company Name</label>
        <input type="text" name="firma_nomi" id="firma_nomi" class="form-control">
        <div id="firmaNomiError" class="invalid-feedback">
            {% for error in form.firma_nomi.errors %}
                {{ error }}<br>
            {% endfor %}
        </div>
    </div>
    <div class="mb-3">
        <label for="bank" class="form-label">Bank</label>
        <input type="text" name="bank" id="bank" class="form-control">
        <div id="bankError" class="invalid-feedback">
            {% for error in form.bank.errors %}
                {{ error }}<br>
            {% endfor %}
        </div>
    </div>
    <div class="mb-3">
        <label for="izoh" class="form-label">Notes</label>
        <textarea name="izoh" id="izoh" class="form-control"></textarea>
        <div id="izohError" class="invalid-feedback">
            {% for error in form.izoh.errors %}
                {{ error }}<br>
            {% endfor %}
        </div>
    </div>
    <input type="hidden" name="chiqim" value="{{ chiqim.id }}" />
    <button type="submit" class="btn btn-primary">Add Payment</button>
</form>

<style>
    .form-label {
        font-weight: 500;
    }
    .form-control, .form-select {
        border-radius: 5px;
        transition: border-color 0.3s ease;
    }
    .is-invalid {
        border-color: #dc3545 !important;
    }
    .invalid-feedback {
        display: none; /* Initially hidden */
        color: #dc3545;
        font-size: 0.875rem;
    }
    .is-invalid + .invalid-feedback {
        display: block; /* Shown when there is an error */
    }
    .alert-danger {
        font-weight: bold;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 15px;
    }
    .btn-primary {
        background-color: #007bff;
        border: none;
        padding: 8px 20px;
        border-radius: 5px;
        transition: background-color 0.3s ease;
    }
    .btn-primary:hover {
        background-color: #0056b3;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const summaInput = document.getElementById('summa');
    const summaError = document.getElementById('summaError');
    const errorContainer = document.getElementById('errorContainer');
    const qoldiqSumma = {{ chiqim.qoldiq_summa|floatformat:2|safe }};

    // Real-time amount validation
    summaInput.addEventListener('input', function(e) {
        const value = parseFloat(e.target.value) || 0;
        if (value > qoldiqSumma) {
            e.target.setCustomValidity("The payment amount cannot exceed the remaining balance!");
            summaError.innerHTML = `The payment amount cannot exceed the remaining balance ($${qoldiqSumma})!`;
            summaInput.classList.add('is-invalid');
        } else if (value <= 0) {
            e.target.setCustomValidity("The amount must be greater than 0!");
            summaError.innerHTML = "The amount must be greater than 0!";
            summaInput.classList.add('is-invalid');
        } else {
            e.target.setCustomValidity('');
            summaError.innerHTML = '';
            summaInput.classList.remove('is-invalid');
        }
    });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const summaInput = document.getElementById('summa');
    const summaError = document.getElementById('summaError');
    const errorContainer = document.getElementById('errorContainer');
    const qoldiqSumma = {{ chiqim.qoldiq_summa|floatformat:2|safe }};

    // Real-time amount validation
    summaInput.addEventListener('input', function(e) {
        const value = parseFloat(e.target.value) || 0;
        if (value > qoldiqSumma) {
            e.target.setCustomValidity("The payment amount cannot exceed the remaining balance!");
            summaError.innerHTML = "The payment amount cannot exceed the remaining balance!";
            summaInput.classList.add('is-invalid');
        } else if (value <= 0) {
            e.target.setCustomValidity("The amount must be greater than 0!");
            summaError.innerHTML = "The amount must be greater than 0!";
            summaInput.classList.add('is-invalid');
        } else {
            e.target.setCustomValidity('');
            summaError.innerHTML = '';
            summaInput.classList.remove('is-invalid');
        }
    });
});
</script>